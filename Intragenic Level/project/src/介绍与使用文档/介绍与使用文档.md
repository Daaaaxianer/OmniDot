# **基因组自比对与可视化**



# 介绍



由4个脚本文件组成一个完整的基因组数据分析流程，调用minimap2进行自比对，完成**基因组自比对与可视化**。

### 1. `make_date_1.py` - 基因组片段切割模块

**功能**：将大基因组文件按指定参数切割成小片段

- 输入：完整的染色体FASTA文件
- 输出：按chunk_size（默认2000bp）切割的片段FASTA文件
- 关键参数：
  - `new_chr`：目标染色体编号
  - `start/end`：切割的起始和结束位置（可设置为"start"/"end"使用整个染色体）
  - `chunk_size`：每个片段的长度
- 输出序列ID格式：`chr1:20000000:20002000`（包含位置信息）

### 2. `make_minimap_2.py` - 序列比对模块

**功能**：使用minimap2进行自比对

- 调用minimap2工具将切割后的片段进行自比对
- 参数设置：使用`-ax ava-ont`模式，适合长序列比对
- 输出：SAM格式的比对结果文件

### 3. `make_date_bed_3.py` - 比对结果解析模块

**功能**：解析SAM文件，提取比对统计信息

- 使用pysam库读取SAM文件
- 解析CS标签获取详细的比对统计：
  - 匹配数、错配数、插入/缺失事件
  - 计算三种同一性百分比（基于匹配、基于事件、总体）
- 对称化处理：使比对结果双向对称
- 输出：TSV格式的比对统计表格

### 4. `make_fignew_4.py` - 可视化模块

**功能**：生成点图可视化比对结果

- 读取比对统计表格

- 创建带颜色映射的散点图：
  - x轴：比对片段的中点位置
  - y轴：比对片段的距离差
  - 颜色：基于同一性百分比（byevents）
  
- 添加同一性分布直方图

- 支持四种布局（top/bot/left/right）

- 输出：高分辨率PNG图片

  ### 5. `run.py` - 运行

  ​	按顺序依次执行4个分析步骤

### 整体流程

完整基因组FASTA
    ↓ (make_date_1.py)
切割成小片段FASTA
    ↓ (make_minimap_2.py)
minimap2自比对 → SAM文件
    ↓ (make_date_bed_3.py)
解析统计信息 → TSV表格
    ↓ (make_fignew_4.py)
生成可视化点图 → PNG图像



# 使用说明

## 输入文件

1个标准的只有一个序列的cds fast文件

```
>chr1
CAGTAAAGTTTGCAAAGAGATTCTGGCAAAGTTGTAATCATCGAATGTGAAATGTCAAGT
AAGTGTAAATGGATTAGTTTGCCAATGGAGGTCGGCAACTCTTTCACATCTGCTCCAAAC
AATTTTAGGACATGCAAGTATTTGAACTTTGATAACATATCATCAGCTATGCCACCCTCC
AGAAATAATGTGCGAAGTGATGCTGATTTTTTTTCATTGATGATTTCCACCATTCTTTCG
GATGAGTATACTGCAAGGTAGCGGTCCTCATTGCTGCTGCTACGATTCAAAATTGATTTT
GCAAAATCGTGCACAAGGTCATGCATTTTATACCTATTTTCTTTTACTTCTTCCAATAAG
GAAGTTTGCAGCAAAATTCTCAAATACTCACATCCTATTTTCTCCATCGTTCTTTCATTT
TGGGAATCCGGTTGAAGAAAGCCTTCAGCCATCCAAAGCTCAACTAGTAGATCTTGTTCC
AACTCAGCATCTTGATCAAAAATTGAGCAATATGCAAAACATTTCTTAACCGGTGCAAGT
GACAGATGATCAAAACTCACCTTAATTATTTGCTCGATCCGACCTTGGTCTCCATTCAAC
AGACTCTCCTCCAAAATAGATTGCCACTCCTCTTTTCTCTTTTTATATAACAAACCTCCA
ATTAACTTTGCTGCCAGAGGTAGACCGTCACATCTTCTTAAAACTCGCTCCCTTATGTCT
TCCAATTCTTTTGGTACTTCTTCCCCTACAGTTGCCCATTTATTAATGATGGACCAGCAA
TCATCATTGCATAGCTTTCCTAGCCCATGGCGAGTAAAATTGATCTGCGGAAGACCGGAC
AGAGTAGTTTCCACTTCTTGCAGACGAGTGGTAACAAGACACCAGCTCCCTTTCTTCGCT
TCGAGTGCCTTCAATGTGGTGAAAAAGTCATCCAATTGTTGATGATTCCACAAATCGTCA
AGAACAAGCAAACATCTTTTTCCCTTGATTTCATTTTGAATTCCTCGAACTATTACGTCC
CTAACATCCGCGTCAGGCTTGTTTCCTGTTGACGATTCTAGAATCATTTTGAAGAGATCC
ATGGTTTCAACTTCTTTAGCCACACAAACCCAAATTTTTTTGTCAAAATGATTATCATTA
AACTGTGGATTGTTGTAAACGGCTTTAG
```

开头必须为     >chr

如  >chr1  >chr2  >chr3  >chr4

## **核心控制参数**

### 在toml文件中修改

```toml
# config.toml（标准格式）
new_chr = 1
chunk_size = 2000   # 每个片段的长度
start = 20000000   #具体的数字或"start"
end = 30000000      #具体的数字或"end"
date_1 = "chr.fa"
out_part_date_1 = "chr.part.fa"
out_part_date_2 = "alignment_part.sam"
out_part_date_3 = "output_part.csv"
savefile = "output_part.csv.png"
pos = "bot"
```

`new_chr=1`	指定目标染色体的编号,从多染色体的FASTA文件中选择特定染色体进行处理

`chunk_size = 2000 `   每个片段的长度（单位：碱基对 bp,将长染色体序列切割成固定长度的小片段

`start = 20000000`  	提取序列的起始位置（单位：bp）`"start"`：表示从染色体开头（位置0）开始,具体数字：如20000000表示从第2000万个碱基开始

`end = 30000000` 	提取序列的结束位置（单位：bp）`"end"`：表示到染色体末尾结束, 具体数字：如30000000表示到第3000万个碱基结束

out_part_date_1 = "chr.part.fa"           # 步骤1输出：切割后的片段
out_part_date_2 = "alignment_part.sam"    # 步骤2输出：比对结果
out_part_date_3 = "output_part.csv"       # 步骤3输出：统计表格
savefile = "output_part.csv.png"          # 步骤4输出：可视化图像

pos = "bot"	控制**点图可视化时布局的方向**

### 例图

pos = "bot"	

![output_chr1.2000.10000.nwe_bot_bed](./output_chr1.2000.10000.nwe_bot_bed.png)

pos = "left"

![output_chr1.2000.10000.nwe_left_bed](./output_chr1.2000.10000.nwe_left_bed.png)

pos = "top"

![output_chr1.2000.10000.nwe_top_bed](./output_chr1.2000.10000.nwe_top_bed.png)